
<html>
<header></header>
<body>
	<div id="createRole">
		<h3>Create new role</h3>
		<p>As an admin, you can create new roles with specific permissions to assign to new and existing users.</p>
		<p>
			<label for="roleNameInput">Role Name</label>
			<input type="text" id="roleNameInput" name="roleNameInput" placeholder="...">
		</p>
		<form>
			<div id="rolePermissionsInput">
				<div id="">
				</div>
			</div>
		</form>
	</div>
	<div id="existingRoles">

</body>
<script>
	'use strict';

	function retrieveAllPermissions(onload, onerror) {
		let xhttp = new XMLHttpRequest()
		xhttp.onload = onload
		xhttp.onerror = onerror
		xhttp.open("GET", "/all_permissions.json", true)
		xhttp.send()
	}

	function removeAllChildNodes(parent) {
	    while (parent.firstChild) {
	        parent.removeChild(parent.firstChild);
	    }
	}

	function populatePermissionCheckboxesInit() {
		let domCheckboxes = document.getElementById("rolePermissionsInput")
		let excuses = document.createTextNode("Loading...")

		removeAllChildNodes(domCheckboxes)
		domCheckboxes.appendChild(excuses)
	}

	function populatePermissionCheckboxesError() {
		let domCheckboxes = document.getElementById("rolePermissionsInput")
		let excuses = document.createTextNode("aw beans.  Something bad happened.")

		removeAllChildNodes(domCheckboxes)
		domCheckboxes.appendChild(excuses)
	}


	function populatePermissionCheckboxesSuccess(all_roles) {
		let domCheckboxes = document.getElementById("rolePermissionsInput")

		removeAllChildNodes(domCheckboxes)

		for(let role of all_roles) {
			let name = role.name
			let checkbox = document.createElement("input")
			let label = document.createElement("label")
			let description = document.createTextNode(name)

			checkbox.type = "checkbox"
			checkbox.id = "checkbox_" + name
			checkbox.name = "permission_" + name
			checkbox.value = "value_" + name

			label.htmlFor = "checkbox_" + name
			label.appendChild(description)

			domCheckboxes.appendChild(checkbox)
			domCheckboxes.appendChild(label)
			domCheckboxes.appendChild(document.createElement("br"))
		}
	}

	function parseAllPermissionsForCheckboxes() {
		try {
			console.log(this.responseText)
			populatePermissionCheckboxesSuccess(JSON.parse(this.responseText).data) 
		} catch (err) {
			console.log(err)
			populatePermissionCheckboxesError()
		}
	}

	//Start doing actual things: 
	populatePermissionCheckboxesInit()
	retrieveAllPermissions
		( parseAllPermissionsForCheckboxes	//TODO:  Why can't I bind "this" here?
		, populatePermissionCheckboxesError
		)







</script>
<footer></footer>
</html>